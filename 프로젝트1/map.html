<!DOCTYPE html>
<html lang="ko">

<head>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <!-- Microsoft Clarity -->
    <script type="text/javascript">
        (function (c, l, a, r, i, t, y) {
            c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments) };
            t = l.createElement(r); t.async = 1; t.src = "https://www.clarity.ms/tag/" + i;
            y = l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t, y);
        })(window, document, "clarity", "script", "v5iipvten3");
    </script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-VZLKFEGD77"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-VZLKFEGD77');
    </script>

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5482753613081557"
        crossorigin="anonymous"></script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ï£ºÎ≥Ä Î™ÖÎãπ Ï∞æÍ∏∞ - 1Îì± ÌåêÎß§Ï†ê ÏßÄÎèÑ</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="ÎÇ¥ Ï£ºÎ≥ÄÏùò Î°úÎòê 1Îì± ÎãπÏ≤® Î™ÖÎãπÏùÑ ÏßÄÎèÑÏóêÏÑú Ï∞æÏïÑÎ≥¥ÏÑ∏Ïöî. Ïã§Ï†ú ÎãπÏ≤® ÌöüÏàòÏôÄ ÏúÑÏπò Ï†ïÎ≥¥Î•º ÌïúÎààÏóê ÌôïÏù∏Ìï† Ïàò ÏûàÏäµÎãàÎã§.">
    <meta name="keywords" content="Î°úÎòêÎ™ÖÎãπ, Î°úÎòêÌåêÎß§Ï†ê, Î°úÎòêÏßÄÎèÑ, Î°úÎòê1Îì±ÏßÄÏó≠, Î≥µÍ∂åÎ∞©, Î°úÎòêÌåêÎß§Ï†êÏúÑÏπò">
    <meta name="author" content="PublicLensk">
    <link rel="canonical" href="https://publiclensk.org/map.html">

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Ï£ºÎ≥Ä Î™ÖÎãπ Ï∞æÍ∏∞ - 1Îì± ÌåêÎß§Ï†ê ÏßÄÎèÑ">
    <meta property="og:description" content="Ï†ÑÍµ≠ Î°úÎòê 1Îì± Î™ÖÎãπ ÏúÑÏπòÏôÄ ÎãπÏ≤® ÌöüÏàòÎ•º ÏßÄÎèÑÏóêÏÑú ÌôïÏù∏ÌïòÏÑ∏Ïöî.">
    <meta property="og:image" content="https://publiclensk.org/lotto_logo.png">
    <meta property="og:url" content="https://publiclensk.org/map.html">
    <meta property="og:site_name" content="PublicLensk">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Ï£ºÎ≥Ä Î™ÖÎãπ Ï∞æÍ∏∞ - 1Îì± ÌåêÎß§Ï†ê ÏßÄÎèÑ">
    <meta name="twitter:description" content="Ï†ÑÍµ≠ Î°úÎòê 1Îì± Î™ÖÎãπ ÏúÑÏπòÏôÄ ÎãπÏ≤® ÌöüÏàòÎ•º ÏßÄÎèÑÏóêÏÑú ÌôïÏù∏ÌïòÏÑ∏Ïöî.">
    <meta name="twitter:image" content="https://publiclensk.org/lotto_logo.png">
    <link rel="stylesheet" as="style" crossorigin
        href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
    <!-- Kakao Map API -->
    <script type="text/javascript"
        src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=8c78a44cbc45fec0aa35705516f1a082&libraries=services,clusterer"></script>

    <!-- Utility Scripts -->
    <script src="js/utils.js?v=20260122_fix3"></script>
    <script src="js/lotto-enhanced.js?v=20260122_fix3"></script>
    <style>
        .map-container {
            width: 100%;
            height: 100vh;
            position: relative;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        .map-header {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            background: white;
            padding: 15px 30px;
            border-radius: 50px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .map-header h1 {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary-blue);
            margin: 0;
        }

        .search-box {
            position: absolute;
            top: 100px;
            left: 20px;
            z-index: 100;
            background: white;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            width: 320px;
        }

        .search-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 10px;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-blue);
        }

        .search-btn {
            width: 100%;
            padding: 12px;
            background: var(--primary-blue);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .search-btn:hover {
            background: var(--primary-orange);
        }

        /* Map Controls Group (Right Side) */
        .map-controls {
            position: absolute;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 100;
        }

        .control-btn {
            width: 44px;
            height: 44px;
            background: white;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            /* Square-ish with rounded corners like Kakao */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: #333;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.2s;
        }

        .control-btn:hover {
            background: #f8f9fa;
        }

        .control-btn.active {
            background: var(--primary-blue);
            color: white;
            border-color: var(--primary-blue);
        }

        /* Bottom Sheet */
        .bottom-sheet {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);
            z-index: 200;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            padding-bottom: env(safe-area-inset-bottom);
            /* Safe area for iPhone X+ */
        }

        .bottom-sheet.active {
            transform: translateY(0);
        }

        .sheet-handle-bar {
            width: 100%;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .sheet-handle {
            width: 40px;
            height: 5px;
            background: #E0E0E0;
            border-radius: 10px;
        }

        .sheet-content {
            padding: 0 25px 30px 25px;
        }

        .sheet-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .sheet-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #111;
            margin-bottom: 4px;
        }

        .sheet-addr {
            font-size: 0.95rem;
            color: #666;
            line-height: 1.4;
        }

        /* Action Buttons Grid */
        .action-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 12px;
            border-radius: 12px;
            background: #F5F6F8;
            color: #333;
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: 600;
            transition: background 0.2s;
            border: none;
            cursor: pointer;
        }

        .action-btn:hover {
            background: #EBEDF0;
        }

        .action-btn i {
            font-size: 1.4rem;
            margin-bottom: 2px;
        }

        .action-btn.share {
            color: #333;
        }

        .action-btn.kakao {
            color: #3C1E1E;
            background: #FAE100;
        }

        .action-btn.kakao:hover {
            background: #E6CF00;
        }

        .action-btn.naver {
            color: white;
            background: #03C75A;
        }

        .action-btn.naver:hover {
            background: #02B050;
        }

        /* Hide old elements */
        .store-info-box,
        .my-location-btn,
        .zoom-control {
            display: none !important;
        }

        .store-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 8px;
        }

        .store-address {
            font-size: 0.95rem;
            color: var(--text-muted);
            margin-bottom: 12px;
        }

        .store-wins {
            display: flex;
            gap: 15px;
            margin-top: 12px;
        }

        .win-badge {
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .win-badge.first {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: white;
        }

        .win-badge.second {
            background: linear-gradient(135deg, #C0C0C0 0%, #A8A8A8 100%);
            color: white;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-muted);
            cursor: pointer;
        }

        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
            padding: 12px 20px;
            background: white;
            border: 2px solid var(--primary-blue);
            color: var(--primary-blue);
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .back-button:hover {
            background: var(--primary-blue);
            color: white;
        }

        .legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            z-index: 100;
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .legend-title {
            font-size: 0.9rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 5px;
            font-size: 0.85rem;
        }

        .legend-marker {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        .marker-gold {
            background: #FFD700;
        }

        .marker-silver {
            background: #C0C0C0;
        }

        .marker-normal {
            background: #4A90E2;
        }

        #roadview {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
            display: none;
        }

        .roadview-close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 9999;
            /* Ensure it's on top of everything */
            padding: 15px 25px;
            /* Larger touch target */
            background: #EF4444;
            /* Red for clear "Exit" action */
            border: none;
            color: white;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s, background 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .roadview-close-btn:hover {
            background: #DC2626;
            transform: scale(1.05);
        }

        /* Custom Zoom Control */
        .zoom-control {
            position: absolute;
            bottom: 190px;
            right: 20px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .zoom-btn {
            width: 50px;
            height: 50px;
            background: white;
            border: none;
            border-radius: 50%;
            font-size: 1.5rem;
            font-weight: 600;
            color: #1F2937;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .zoom-btn:hover {
            background: var(--primary-blue);
            color: white;
            transform: scale(1.1);
        }

        /* Click Coordinate Result */
        .click-result {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 10px 20px;
            border-radius: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
            font-size: 0.9rem;
            font-weight: 600;
            color: #1F2937;
            display: none;
            /* Initially hidden */
        }

        .zoom-control {
            position: absolute;
            bottom: 190px;
            right: 20px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .zoom-btn {
            width: 50px;
            height: 50px;
            background: white;
            border: none;
            border-radius: 50%;
            font-size: 1.5rem;
            font-weight: 600;
            color: #1F2937;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .zoom-btn:hover {
            background: var(--primary-blue);
            color: white;
            transform: scale(1.1);
        }

        .roadview-close-btn:hover {
            background: var(--primary-blue);
            color: white;
        }

        @media (max-width: 768px) {
            .search-box {
                width: calc(100% - 40px);
                left: 20px;
                right: 20px;
            }

            .store-info-box {
                min-width: auto;
                width: calc(100% - 40px);
            }

            .map-header h1 {
                font-size: 1.1rem;
            }
        }

        /* Custom Overlay Style */
        .custom-overlay {
            position: relative;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            padding: 15px;
            min-width: 260px;
            border: 1px solid #E2E8F0;
        }

        .custom-overlay::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            border-top: 10px solid white;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
        }

        .overlay-close {
            position: absolute;
            top: 10px;
            right: 10px;
            border: none;
            background: none;
            color: #94A3B8;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0;
            line-height: 1;
        }

        .overlay-close:hover {
            color: #1F2937;
        }

        /* Roadview Controls */
        .roadview-controls {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 201;
            display: flex;
            gap: 8px;
        }

        .rv-btn {
            padding: 8px 12px;
            background: white;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            color: #1e293b;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.2s;
            text-decoration: none;
            display: flex;
            align-items: center;
        }

        .rv-btn:hover {
            background: #f1f5f9;
            color: #0f172a;
        }

        /* Roadview Controls */
        .roadview-controls {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 201;
            /* Higher than map, same level as close button */
            display: flex;
            gap: 8px;
        }

        .rv-btn {
            padding: 8px 12px;
            background: white;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            color: #1e293b;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.2s;
            text-decoration: none;
            display: flex;
            align-items: center;
        }

        .rv-btn:hover {
            background: #f1f5f9;
            color: #0f172a;
        }

        /* Roadview Toggle Button - Positioned to left of standard controls */
        .roadview-control-btn {
            position: absolute;
            top: 25px;
            /* Aligned with typical map controls */
            right: 140px;
            /* Moved left to avoid overlapping with MapTypeControl */
            z-index: 100;
            padding: 8px 12px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            /* Squared corners to match standard controls */
            font-weight: 600;
            color: #1F2937;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.85rem;
            height: 38px;
        }

        .roadview-control-btn:hover {
            background: #f8f9fa;
        }

        .roadview-control-btn.active {
            background: var(--primary-blue);
            color: white;
            border-color: var(--primary-blue);
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        /* Marker Tracker Styles */
        .tracker {
            position: absolute;
            z-index: 100;
            cursor: pointer;
        }

        .balloon {
            position: absolute;
            width: 60px;
            height: 60px;
            background: url('https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/balloon.png') no-repeat;
            right: -30px;
            bottom: -30px;
        }

        .tracker .icon {
            position: absolute;
            width: 27px;
            height: 15px;
            background: url('https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/icon.png') no-repeat;
            left: -14px;
            top: -7px;
        }

        .overlay-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #1E3A8A;
            margin-bottom: 5px;
            padding-right: 20px;
        }

        .overlay-addr {
            font-size: 0.85rem;
            color: #64748B;
            margin-bottom: 12px;
        }

        .overlay-buttons {
            display: flex;
            gap: 8px;
        }

        .overlay-btn {
            flex: 1;
            padding: 8px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            text-decoration: none;
            border: none;
        }

        .search-results-list {
            position: absolute;
            top: 60px;
            left: 20px;
            width: 320px;
            max-height: 400px;
            overflow-y: auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            padding: 0;
            margin: 0;
            list-style: none;
            display: none;
        }

        .search-results-list li {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background 0.2s;
        }

        .search-results-list li:hover {
            background: #f8f9fa;
        }

        .search-results-list li:last-child {
            border-bottom: none;
        }

        .search-item-title {
            font-weight: bold;
            font-size: 0.95rem;
            color: #1E3A8A;
            margin-bottom: 4px;
        }

        .search-item-addr {
            font-size: 0.85rem;
            color: #64748B;
        }

        @media (max-width: 768px) {
            .search-results-list {
                width: calc(100% - 40px);
                left: 20px;
                right: 20px;
            }
        }
    </style>
</head>

<body>
    <div class="map-container">
        <a href="index.html" class="back-button">üè† ÌôàÏúºÎ°ú</a>

        <div class="map-header">
            <a href="index.html" style="text-decoration: none; display: flex; align-items: center; gap: 10px;">
                <img src="lotto_logo.png" alt="Î°úÎòê Î°úÍ≥†" style="height: 24px;">
                <h1>Î™ÖÎãπ ÏßÄÎèÑ</h1>
            </a>
            <button onclick="toggleLegend()" class="legend-btn" style="
                background: none; 
                border: 1px solid #eee; 
                padding: 6px 12px; 
                border-radius: 15px; 
                font-size: 0.85rem; 
                cursor: pointer;">
                Î≤îÎ°Ä
            </button>
        </div>

        <!-- Floating Controls (Right) -->
        <div class="map-controls">
            <!-- Heatmap Toggle -->
            <button id="heatmapBtn" class="control-btn" onclick="toggleHeatmap()" title="ÌûàÌä∏Îßµ Î≥¥Í∏∞">
                <i class="fas fa-layer-group"></i>
            </button>
            <div style="height: 10px;"></div> <!-- Spacer -->

            <!-- Roadview Toggle -->
            <button id="roadviewBtn" class="control-btn" onclick="toggleRoadviewMode()" title="Î°úÎìúÎ∑∞ Î™®Îìú">
                <i class="fas fa-street-view"></i>
            </button>

            <div style="height: 10px;"></div>

            <!-- Zoom Controls -->
            <button class="control-btn" onclick="zoomIn()" title="ÌôïÎåÄ">
                <i class="fas fa-plus"></i>
            </button>
            <button class="control-btn" onclick="zoomOut()" title="Ï∂ïÏÜå">
                <i class="fas fa-minus"></i>
            </button>

            <div style="height: 10px;"></div> <!-- Spacer -->

            <!-- My Location -->
            <button class="control-btn" onclick="goToMyLocation()" title="ÎÇ¥ ÏúÑÏπò">
                <i class="fas fa-crosshairs"></i>
            </button>
        </div>

        <!-- Bottom Sheet -->
        <div class="bottom-sheet" id="storeBottomSheet">
            <div class="sheet-handle-bar" onclick="closeBottomSheet()">
                <div class="sheet-handle"></div>
            </div>
            <div class="sheet-content">
                <!-- Content injected via JS -->
                <div id="sheetBody"></div>
            </div>
        </div>

        <!-- Click Coordinate & Zoom Level Display -->
        <div id="clickResult" class="click-result">
            ÏßÄÎèÑÎ•º ÌÅ¥Î¶≠ÌïòÍ±∞ÎÇò ÌôïÎåÄ/Ï∂ïÏÜåÌï¥Î≥¥ÏÑ∏Ïöî
        </div>

        <div class="zoom-control">
            <button class="zoom-btn" onclick="zoomIn()" title="ÌôïÎåÄ">+</button>
            <button class="zoom-btn" onclick="zoomOut()" title="Ï∂ïÏÜå">-</button>
        </div>

        <div class="legend">
            <div class="legend-title" onclick="filterMarkers('all')" style="cursor: pointer;" title="Ï†ÑÏ≤¥ Î≥¥Í∏∞">Î≤îÎ°Ä (Ï†ÑÏ≤¥) ‚Üª
            </div>
            <div class="legend-item" onclick="filterMarkers('gold')" id="legend-gold">
                <div class="legend-marker marker-gold"></div>
                <span>1Îì± ÎãπÏ≤®Ï†ê (3Ìöå Ïù¥ÏÉÅ)</span>
            </div>
            <div class="legend-item" onclick="filterMarkers('silver')" id="legend-silver">
                <div class="legend-marker marker-silver"></div>
                <span>1Îì± ÎãπÏ≤®Ï†ê (1-2Ìöå)</span>
            </div>
            <div class="legend-item" onclick="filterMarkers('normal')" id="legend-normal">
                <div class="legend-marker marker-normal"></div>
                <span>ÏùºÎ∞ò ÌåêÎß§Ï†ê</span>
            </div>
        </div>

        <div id="map"></div>

        <!-- Î°úÎìúÎ∑∞ Ïª®ÌÖåÏù¥ÎÑà -->
        <div id="roadview">
            <div class="roadview-controls">
                <button class="rv-btn" onclick="closeRoadview()">üó∫Ô∏è ÏßÄÎèÑ Î≥¥Í∏∞</button>
                <button class="rv-btn" onclick="resetRoadview()">‚Ü∫ Ï¥àÍ∏∞Ìôî</button>
                <a id="rvLink" href="#" target="_blank" class="rv-btn">üåè Ïπ¥Ïπ¥Ïò§Îßµ</a>
            </div>
            <button class="roadview-close-btn" id="roadview-close" onclick="closeRoadview()">‚úï Î°úÎìúÎ∑∞ Îã´Í∏∞</button>
        </div>

        <!-- Î≤îÎ°Ä (Ìò∏Í∞±ÎÖ∏ÎÖ∏ Ïä§ÌÉÄÏùº) -->
        <div style="
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 15px 25px;
            border-radius: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex;
            gap: 20px;
            align-items: center;
            z-index: 100;
        ">
            <div style="display: flex; align-items: center; gap: 8px;">
                <div
                    style="width: 40px; height: 24px; background: #FFD700; border-radius: 12px; text-align: center; color: #1F2937; font-size: 0.75rem; line-height: 24px; font-weight: 700; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    3+</div>
                <span style="font-size: 0.9rem; font-weight: 600; color: #1F2937;">1Îì± 3Ìöå Ïù¥ÏÉÅ üèÜ</span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
                <div
                    style="width: 40px; height: 24px; background: #C0C0C0; border-radius: 12px; text-align: center; color: #1F2937; font-size: 0.75rem; line-height: 24px; font-weight: 700; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    1-2</div>
                <span style="font-size: 0.9rem; font-weight: 600; color: #1F2937;">1Îì± 1-2Ìöå ü•à</span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
                <div
                    style="width: 40px; height: 24px; background: #A0A0A0; border-radius: 12px; text-align: center; color: white; font-size: 0.75rem; line-height: 24px; font-weight: 700;">
                    0</div>
                <span style="font-size: 0.9rem; font-weight: 600; color: #1F2937;">ÏùºÎ∞ò ÌåêÎß§Ï†ê</span>
            </div>
        </div>

        <div class="store-info-box" id="store-info">
            <button class="close-btn" onclick="closeStoreInfo()">‚úï</button>
            <div class="store-name" id="store-name">ÌåêÎß§Ï†ê Ïù¥Î¶Ñ</div>
            <div class="store-address" id="store-address">Ï£ºÏÜå</div>
            <div class="store-distance" id="store-distance"
                style="display:none; font-size:0.9rem; color:#2563EB; margin:5px 0 10px 0; font-weight:500;"></div>
            <div class="store-wins" id="store-wins">
                <div class="win-badge first">1Îì± 3Ìöå</div>
                <div class="win-badge second">2Îì± 7Ìöå</div>
            </div>
            <div id="store-actions" style="margin-top: 15px;"></div>
        </div>
    </div>

    <script>
        // Google Sheets API URL (Apps Script Web App)
        const SHEETS_API_URL = 'https://script.google.com/macros/s/AKfycbztxG09bbt0mNRfErtMiNwtdL8jhXk-L_HPL9Enja-iAbse7YgAkHJKUnEGmO5vmUOQ/exec';

        // Ï†ÑÏó≠ Î≥ÄÏàò
        let storeData = [];
        let map;
        let markers = [];
        let clusterer; // ÎßàÏª§ ÌÅ¥Îü¨Ïä§ÌÑ∞Îü¨

        // Î°úÎìúÎ∑∞ Í¥ÄÎ†® Î≥ÄÏàò
        let isRoadviewMode = false;
        let roadviewMarker = null;
        let roadviewClient = null;
        let roadview = null;
        let rvResetValue = {}; // Î°úÎìúÎ∑∞ Î¶¨ÏÖãÏùÑ ÏúÑÌïú Ï¥àÍ∏∞Í∞í Ï†ÄÏû•

        // Heatmap Variables
        let isHeatmapMode = false;
        let heatmapOverlays = []; // Array to store circle overlays

        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // ÏßÄÍµ¨ Î∞òÏßÄÎ¶Ñ (km)
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a =
                Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            const d = R * c; // Í±∞Î¶¨ (km)

            if (d < 1) return Math.round(d * 1000) + 'm';
            return d.toFixed(1) + 'km';
        }

        // === Google SheetsÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞ ===
        async function loadStoreData() {
            try {
                console.log('Î°úÎòê Î™ÖÎãπ Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ï§ë...');
                const response = await fetch(SHEETS_API_URL);

                if (!response.ok) {
                    throw new Error('API ÏùëÎãµ Ïã§Ìå®');
                }

                storeData = await response.json();
                console.log('‚úÖ Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏôÑÎ£å:', storeData.length, 'Í∞ú ÌåêÎß§Ï†ê');

                return storeData;
            } catch (error) {
                console.warn('‚ö†Ô∏è API Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®, Fallback Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö©:', error);
                storeData = getFallbackData();
                return storeData;
            }
        }

        // === Fallback Îç∞Ïù¥ÌÑ∞ (API Ïã§Ìå® Ïãú ÏÇ¨Ïö©) ===
        function getFallbackData() {
            return [
                {
                    name: "ÏÇºÏÑ±ÎåÄÎ∞ïÎ≥µÍ∂åÎ∞©",
                    address: "ÏÑúÏö∏ Í∞ïÎÇ®Íµ¨ Î¥âÏùÄÏÇ¨Î°ú74Í∏∏ 13 101Ìò∏",
                    lat: 37.5089,
                    lng: 127.0533,
                    first: 3,
                    second: 7
                },
                {
                    name: "Î°úÎòêÎ∞±ÌôîÏ†ê",
                    address: "ÏÑúÏö∏ ÏÑúÏ¥àÍµ¨ Í∞ïÎÇ®ÎåÄÎ°ú 27",
                    lat: 37.5000,
                    lng: 127.0152,
                    first: 4,
                    second: 8
                },
                {
                    name: "Ìô©Í∏àÏÜêÎ≥µÍ∂å",
                    address: "ÏÑúÏö∏ ÏÜ°ÌååÍµ¨ Ïò¨Î¶ºÌîΩÎ°ú35Îã§Í∏∏ 42",
                    lat: 37.5144,
                    lng: 127.1060,
                    first: 2,
                    second: 4
                },
                {
                    name: "ÌñâÏö¥Î≥µÍ∂åÎ∞©",
                    address: "ÏÑúÏö∏ ÏòÅÎì±Ìè¨Íµ¨ Ïó¨ÏùòÎåÄÎ°ú 108",
                    lat: 37.5219,
                    lng: 126.9245,
                    first: 1,
                    second: 3
                }
            ];
        }

        // ÏßÄÎèÑ Ï¥àÍ∏∞Ìôî (Kakao API ÌÇ§ ÌïÑÏöî)
        async function initMap() {
            // Î®ºÏ†Ä Îç∞Ïù¥ÌÑ∞ Î°úÎìú
            await loadStoreData();

            // Kakao APIÍ∞Ä Î°úÎìúÎêòÏßÄ ÏïäÏïòÏùÑ Í≤ΩÏö∞Î•º ÎåÄÎπÑÌïú Ìè¥Î∞±
            if (typeof kakao === 'undefined' || typeof kakao.maps === 'undefined') {
                console.error('Kakao Maps API not loaded');
                alert('ÏßÄÎèÑÎ•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
                showSimpleMap();
                return;
            }

            try {
                const container = document.getElementById('map');
                const options = {
                    center: new kakao.maps.LatLng(37.5089, 127.0533), // ÏÑúÏö∏ Í∞ïÎÇ®
                    level: 5
                };

                map = new kakao.maps.Map(container, options);

                // === ÏßÄÎèÑ ÌÉÄÏûÖ Ïª®Ìä∏Î°§ Ï∂îÍ∞Ä (ÏßÄÎèÑ/Ïä§Ïπ¥Ïù¥Î∑∞) ===
                const mapTypeControl = new kakao.maps.MapTypeControl();
                map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);

                // ÌåêÎß§Ï†ê ÎßàÏª§ ÌëúÏãú
                displayStores();

                // ÏòÅÏó≠ Î≥ÄÍ≤Ω Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Îì±Î°ù
                initBoundsListener();

                // === 2. ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Îì±Î°ù ===
                // Click marker removed

                kakao.maps.event.addListener(map, 'click', function (mouseEvent) {
                    // Î°úÎìúÎ∑∞ Î™®ÎìúÏùº Í≤ΩÏö∞ÏóêÎßå ÏûëÎèô
                    if (isRoadviewMode) {
                        const latlng = mouseEvent.latLng;
                        if (roadviewMarker) {
                            roadviewMarker.setPosition(latlng);
                        }
                        showRoadview(latlng.getLat(), latlng.getLng());
                    }
                });

                // === 3. Ï§å Î≥ÄÍ≤Ω Ïù¥Î≤§Ìä∏ Îì±Î°ù ===
                kakao.maps.event.addListener(map, 'zoom_changed', function () {
                    const level = map.getLevel();
                    const message = 'ÌòÑÏû¨ ÏßÄÎèÑ Î†àÎ≤®ÏùÄ ' + level + ' ÏûÖÎãàÎã§';

                    const resultDiv = document.getElementById('clickResult');
                    resultDiv.innerHTML = message;
                    resultDiv.style.display = 'block';
                });

            } catch (error) {
                console.error('Map initialization error:', error);
                alert('ÏßÄÎèÑ Ï¥àÍ∏∞Ìôî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message);
                showSimpleMap();
            }
        }

        // Custom Zoom Functions
        function zoomIn() {
            const level = map.getLevel();
            map.setLevel(level - 1, { animate: true });
        }

        function zoomOut() {
            const level = map.getLevel();
            map.setLevel(level + 1, { animate: true });
        }

        // Í∞ÑÎã®Ìïú HTML ÏßÄÎèÑ (API ÎåÄÏ≤¥Ïö©)
        function showSimpleMap() {
            document.getElementById('map').innerHTML = `
                <div style="display: flex; flex-wrap: wrap; padding: 20px; gap: 15px; overflow-y: auto;">
                    ${storeData.map(store => `
                        <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); width: calc(50% - 10px); min-width: 280px;" onclick='showStoreInfo(${JSON.stringify(store)})'>
                            <div style="font-size: 1.2rem; font-weight: 700; color: #1E3A8A; margin-bottom: 8px;">${store.name}</div>
                            <div style="font-size: 0.9rem; color: #64748B; margin-bottom: 12px;">${store.address}</div>
                            <div style="display: flex; gap: 10px;">
                                ${store.first > 0 ? `<span style="background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); color: white; padding: 6px 12px; border-radius: 6px; font-size: 0.85rem; font-weight: 600;">1Îì± ${store.first}Ìöå</span>` : ''}
                                ${store.second > 0 ? `<span style="background: linear-gradient(135deg, #C0C0C0 0%, #A8A8A8 100%); color: white; padding: 6px 12px; border-radius: 6px; font-size: 0.85rem; font-weight: 600;">2Îì± ${store.second}Ìöå</span>` : ''}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function displayStores() {
            // ÌÅ¥Îü¨Ïä§ÌÑ∞Îü¨ Ï¥àÍ∏∞Ìôî
            clusterer = new kakao.maps.MarkerClusterer({
                map: map,
                averageCenter: true,
                minLevel: 6,
                disableClickZoom: true, // ÌÅ¥Î¶≠ Ïãú 1Î†àÎ≤®Ïî© ÌôïÎåÄÎ•º ÏúÑÌï¥ true ÏÑ§Ï†ï
                styles: [{
                    width: '53px',
                    height: '52px',
                    background: 'rgba(255, 215, 0, 0.9)',
                    borderRadius: '25px',
                    color: '#1F2937',
                    textAlign: 'center',
                    fontWeight: 'bold',
                    lineHeight: '52px',
                    fontSize: '14px'
                }]
            });

            // ÎßàÏª§ ÌÅ¥Îü¨Ïä§ÌÑ∞Îü¨ ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Îì±Î°ù
            kakao.maps.event.addListener(clusterer, 'clusterclick', function (cluster) {
                // ÌòÑÏû¨ ÏßÄÎèÑ Î†àÎ≤®ÏóêÏÑú 1Î†àÎ≤® ÌôïÎåÄÌïú Î†àÎ≤®
                var level = map.getLevel() - 1;
                // ÏßÄÎèÑÎ•º ÌÅ¥Î¶≠Îêú ÌÅ¥Îü¨Ïä§ÌÑ∞Ïùò ÎßàÏª§Ïùò ÏúÑÏπòÎ•º Í∏∞Ï§ÄÏúºÎ°ú ÌôïÎåÄÌï©ÎãàÎã§
                map.setLevel(level, { anchor: cluster.getCenter() });
            });

            storeData.forEach(store => {
                const markerPosition = new kakao.maps.LatLng(store.lat, store.lng);

                // ÎãπÏ≤® ÌöüÏàòÏóê Îî∞Îùº ÎßàÏª§ ÏÉâÏÉÅ Í≤∞Ï†ï
                let balloonColor;
                if (store.first >= 3) {
                    balloonColor = '#FFD700'; // Í∏àÏÉâ
                } else if (store.first >= 1) {
                    balloonColor = '#C0C0C0'; // ÏùÄÏÉâ
                } else {
                    balloonColor = '#A0A0A0'; // ÌöåÏÉâ
                }

                // SVG ÎßàÏª§ Ïù¥ÎØ∏ÏßÄ ÏÉùÏÑ± (Ìò∏Í∞±ÎÖ∏ÎÖ∏ Ïä§ÌÉÄÏùº)
                const svgMarker = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="50" height="30" viewBox="0 0 50 30">
                        <rect x="0" y="0" width="50" height="30" rx="15" ry="15" 
                              fill="${balloonColor}" 
                              stroke="#000" 
                              stroke-width="0.5" 
                              opacity="0.95"/>
                        <text x="25" y="20" 
                              font-family="Pretendard, sans-serif" 
                              font-size="13" 
                              font-weight="700" 
                              fill="#fff" 
                              text-anchor="middle">${store.first || 0}Ìöå</text>
                    </svg>
                `;

                const markerImage = new kakao.maps.MarkerImage(
                    'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(svgMarker),
                    new kakao.maps.Size(50, 30),
                    { offset: new kakao.maps.Point(25, 15) }
                );

                // ÎßàÏª§ ÏÉùÏÑ±
                const marker = new kakao.maps.Marker({
                    position: markerPosition,
                    image: markerImage,
                    clickable: true
                });

                // ÎßàÏª§Ïóê ÌåêÎß§Ï†ê Ï†ïÎ≥¥ Ï†ÄÏû•
                marker.storeInfo = store;

                // ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
                kakao.maps.event.addListener(marker, 'click', function () {
                    // Î°úÎìúÎ∑∞ Î™®ÎìúÏùº Í≤ΩÏö∞ ÎßàÏª§ ÌÅ¥Î¶≠ Ïãú Ìï¥Îãπ ÏúÑÏπòÏùò Î°úÎìúÎ∑∞ Ïã§Ìñâ
                    if (isRoadviewMode) {
                        showRoadview(store.lat, store.lng, store.name);
                        // Î°úÎìúÎ∑∞ ÎßàÏª§ÎèÑ Ìï¥Îãπ ÏúÑÏπòÎ°ú Ïù¥Îèô
                        if (roadviewMarker) {
                            roadviewMarker.setPosition(new kakao.maps.LatLng(store.lat, store.lng));
                        }
                        return;
                    }
                    showStoreInfoOnMap(marker.storeInfo);
                });

                markers.push(marker);
            });

            // ÌÅ¥Îü¨Ïä§ÌÑ∞Îü¨Ïóê ÎßàÏª§ Ï∂îÍ∞Ä
            clusterer.addMarkers(markers);

            // === ÏÉÅÏúÑ ÎãπÏ≤®Ï†ê(1Îì± 3Ìöå Ïù¥ÏÉÅ)Ïóê ÎßàÏª§ Ìä∏ÎûòÏª§ Ï†ÅÏö© ===
            // 1Îì± ÎãπÏ≤® ÌöüÏàò ÎÇ¥Î¶ºÏ∞®Ïàú Ï†ïÎ†¨ ÌõÑ ÏÉÅÏúÑ 3Í∞ú ÏÑ†ÌÉù
            const topStores = [...storeData].sort((a, b) => b.first - a.first).slice(0, 3);

            markers.forEach(marker => {
                // ÏÉÅÏúÑ 3Í∞ú Ï†êÌè¨Ïóê Ìè¨Ìï®ÎêòÎäîÏßÄ ÌôïÏù∏
                const isTopStore = topStores.some(top => top.name === marker.storeInfo.name && top.lat === marker.storeInfo.lat);

                if (isTopStore) {
                    const tracker = new MarkerTracker(map, marker);
                    tracker.run();
                }
            });
        }

        function createMarkerImage(color) {
            const imageSrc = `data:image/svg+xml,%3Csvg width='30' height='40' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M15 0C6.7 0 0 6.7 0 15c0 11.25 15 25 15 25s15-13.75 15-25c0-8.3-6.7-15-15-15z' fill='${encodeURIComponent(color)}'/%3E%3Ccircle cx='15' cy='15' r='8' fill='white'/%3E%3C/svg%3E`;
            const imageSize = new kakao.maps.Size(30, 40);
            const imageOption = { offset: new kakao.maps.Point(15, 40) };

            return new kakao.maps.MarkerImage(imageSrc, imageSize, imageOption);
        }



        function closeOverlay() {
            if (currentOverlay) {
                currentOverlay.setMap(null);
                currentOverlay = null;
            }
        }

        function closeBottomSheet() {
            document.getElementById('storeBottomSheet').classList.remove('active');
            // ÏÑ†ÌÉùÎêú ÎßàÏª§Í∞Ä ÏûàÎã§Î©¥ Îã´Í∏∞ Îì± Ï∂îÍ∞Ä Î°úÏßÅ Í∞ÄÎä•
            if (currentOverlay) {
                currentOverlay.setMap(null);
                currentOverlay = null; // Ïò§Î≤ÑÎ†àÏù¥ÎèÑ Í∞ôÏù¥ Îã´Í∏∞
            }
        }

        // Toggle Heatmap Mode
        function toggleHeatmap() {
            isHeatmapMode = !isHeatmapMode;
            const btn = document.getElementById('heatmapBtn');

            if (isHeatmapMode) {
                btn.classList.add('active');

                // Hide Clusters & Markers
                clusterer.clear();
                // Note: markers array still holds marker objects but clusterer manages map display
                // If markers were added directly to map, we'd need to setMap(null) for each.
                // Assuming clusterer handles everything.

                // Draw Heatmap Circles
                drawHeatmap();
            } else {
                btn.classList.remove('active');

                // Clear Heatmap
                clearHeatmap();

                // Show Clusters
                clusterer.addMarkers(markers);
            }
        }

        function drawHeatmap() {
            storeData.forEach(store => {
                // Determine Color & Radius based on 1st prize wins
                let color = '#FFD700'; // Default Yellow
                let opacity = 0.4;
                let radius = 300; // Base 300m

                if (store.first >= 10) {
                    color = '#DC2626'; // Red
                    opacity = 0.6;
                    radius = 500;
                } else if (store.first >= 5) {
                    color = '#F97316'; // Orange
                    opacity = 0.5;
                    radius = 400;
                }

                // Create Circle
                const circle = new kakao.maps.Circle({
                    center: new kakao.maps.LatLng(store.lat, store.lng),
                    radius: radius,
                    strokeWeight: 0,
                    fillColor: color,
                    fillOpacity: opacity
                });

                circle.setMap(map);
                heatmapOverlays.push(circle);

                // Add click listener to circle (optional: open info)
                kakao.maps.event.addListener(circle, 'click', function () {
                    showStoreInfoOnMap(store);
                });
            });
        }

        function clearHeatmap() {
            heatmapOverlays.forEach(circle => circle.setMap(null));
            heatmapOverlays = [];
        }

        function showStoreInfoOnMap(store) {
            // Update Bottom Sheet Content
            const sheetBody = document.getElementById('sheetBody');

            // Badges
            let badges = '';
            if (store.first > 0) badges += `<span class="win-badge first">1Îì± ${store.first}Ìöå</span>`;
            if (store.second > 0) badges += `<span class="win-badge second">2Îì± ${store.second}Ìöå</span>`;
            if (!badges) badges = '<span style="color:#999;font-size:0.9rem;">ÎãπÏ≤® Ïù¥Î†• ÏßëÍ≥Ñ Ï§ë</span>';

            // Distance
            let distHTML = '';
            if (currentUserLocation) {
                const dist = calculateDistance(currentUserLocation.lat, currentUserLocation.lng, store.lat, store.lng);
                distHTML = `<div style="font-size:0.9rem; color:#2563EB; margin-top:5px;">üìç ÎÇ¥ ÏúÑÏπòÏóêÏÑú ${dist}</div>`;
            }

            sheetBody.innerHTML = `
                <div class="sheet-header">
                    <div>
                        <div class="sheet-title">${store.name}</div>
                        <div class="sheet-addr">${store.address}</div>
                        ${distHTML}
                    </div>
                </div>
                <div class="store-wins" style="margin-bottom:20px;">
                    ${badges}
                </div>
                
                <div class="action-grid">
                    <a href="https://map.kakao.com/link/to/${store.name},${store.lat},${store.lng}" target="_blank" class="action-btn kakao">
                        <i class="fas fa-map-marked-alt"></i> Ïπ¥Ïπ¥Ïò§Îßµ
                    </a>
                    <a href="https://map.naver.com/index.nhn?slng=${store.lng}&slat=${store.lat}&stext=${store.name}" target="_blank" class="action-btn naver">
                        <i class="fas fa-map-signs"></i> ÎÑ§Ïù¥Î≤ÑÎßµ
                    </a>
                    <button class="action-btn share" onclick="processShare('${store.name}', '${store.address}', ${store.first})">
                        <i class="fas fa-share-alt"></i> Í≥µÏú†ÌïòÍ∏∞
                    </button>
                </div>
                
                 <div style="text-align: center; margin-top: 15px;">
                    <a onclick="showRoadview(${store.lat}, ${store.lng}, '${store.name}')" style="color: #64748B; font-size: 0.85rem; text-decoration: underline; cursor: pointer;">
                        üì∑ Î°úÎìúÎ∑∞ ÎØ∏Î¶¨Î≥¥Í∏∞
                    </a>
                </div>
            `;

            // Display Bottom Sheet
            document.getElementById('storeBottomSheet').classList.add('active');

            // Pan map to store (with offset for bottom sheet)
            const position = new kakao.maps.LatLng(store.lat, store.lng);

            // Adjust center slightly down so marker isn't covered by sheet
            // Simple approach: pan directly to lat/lng, then maybe zoom in
            map.panTo(position);

            // Optional: Create a temporary highlight marker or overlay if needed
            // For now, relying on the existing marker or circle interaction
        }

        function showStoreInfo(store) {
            showStoreInfoOnMap(store);
        }

        function closeStoreInfo() {
            document.getElementById('store-info').classList.remove('active');
        }

        function searchLocation(keyword) {
            const query = keyword || document.getElementById('search-input').value.trim();
            if (!query) {
                alert('Í≤ÄÏÉâÌï† ÏßÄÏó≠Î™ÖÏù¥ÎÇò Ïû•ÏÜåÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî.');
                return;
            }

            const ps = new kakao.maps.services.Places();
            const listEl = document.getElementById('search-results');

            // ÌÇ§ÏõåÎìúÎ°ú Ïû•ÏÜåÎ•º Í≤ÄÏÉâÌï©ÎãàÎã§
            ps.keywordSearch(query, function (data, status, pagination) {
                if (status === kakao.maps.services.Status.OK) {
                    // Í≤ÄÏÉâ Í≤∞Í≥º Î¶¨Ïä§Ìä∏ ÌëúÏãú
                    displaySearchList(data);

                    // Ï≤´ Î≤àÏß∏ Í≤∞Í≥ºÎ°ú Ïù¥Îèô
                    const place = data[0];
                    const coords = new kakao.maps.LatLng(place.y, place.x);
                    map.setCenter(coords);
                    map.setLevel(3);

                } else if (status === kakao.maps.services.Status.ZERO_RESULT) {
                    // ÌÇ§ÏõåÎìú Ïã§Ìå® Ïãú Ï£ºÏÜå Í≤ÄÏÉâ
                    const geocoder = new kakao.maps.services.Geocoder();
                    geocoder.addressSearch(query, function (result, addrStatus) {
                        if (addrStatus === kakao.maps.services.Status.OK) {
                            const coords = new kakao.maps.LatLng(result[0].y, result[0].x);
                            map.setCenter(coords);
                            map.setLevel(3);
                            listEl.style.display = 'none'; // Ï£ºÏÜå Í≤ÄÏÉâ Ïãú Î¶¨Ïä§Ìä∏ Ïà®ÍπÄ
                        } else {
                            alert('Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§.');
                            listEl.style.display = 'none';
                        }
                    });
                } else {
                    alert('Í≤ÄÏÉâ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                }
            });
        }

        function displaySearchList(places) {
            const listEl = document.getElementById('search-results');
            listEl.innerHTML = '';
            listEl.style.display = 'block';

            places.slice(0, 5).forEach(place => {
                const item = document.createElement('li');
                item.innerHTML = `
            <div class="search-item-title">${place.place_name}</div>
                <div class="search-item-addr">${place.address_name}</div>
        `;
                item.onclick = () => {
                    const coords = new kakao.maps.LatLng(place.y, place.x);
                    map.setCenter(coords);
                    map.setLevel(3);

                    // ÏûÑÏãú ÎßàÏª§
                    const marker = new kakao.maps.Marker({
                        map: map,
                        position: coords
                    });
                    const infowindow = new kakao.maps.InfoWindow({
                        content: `<div style="padding:5px;font-size:12px;">${place.place_name}</div>`
                    });
                    infowindow.open(map, marker);
                    setTimeout(() => { marker.setMap(null); infowindow.close(); }, 3000);

                    listEl.style.display = 'none';
                };
                listEl.appendChild(item);
            });
        }


        function goToMyLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;

                    currentUserLocation = { lat, lng }; // ÏúÑÏπò Ï†ÄÏû•

                    if (typeof kakao !== 'undefined' && map) {
                        const moveLatLon = new kakao.maps.LatLng(lat, lng);
                        map.setCenter(moveLatLon);
                    } else {
                        alert(`ÎÇ¥ ÏúÑÏπò: ${lat.toFixed(4)}, ${lng.toFixed(4)}\nÏßÄÎèÑ API Ïó∞Îèô ÌõÑ ÏúÑÏπò Ïù¥ÎèôÏù¥ Í∞ÄÎä•Ìï©ÎãàÎã§.`);
                    }
                }, () => {
                    alert('ÏúÑÏπò Ï†ïÎ≥¥Î•º Í∞ÄÏ†∏Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.');
                });
            } else {
                alert('Ïù¥ Î∏åÎùºÏö∞Ï†ÄÎäî ÏúÑÏπò ÏÑúÎπÑÏä§Î•º ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.');
            }
        }

        // Î°úÎìúÎ∑∞ Ï¥àÍ∏∞Ìôî Î∞è ÌëúÏãú Ìï®Ïàò
        function initRoadview(lat, lng) {
            showRoadview(lat, lng, null);
        }

        // Î°úÎìúÎ∑∞ ÌëúÏãú Ìï®Ïàò (Ïù¥Î¶Ñ Ïù∏Ïûê Ï∂îÍ∞Ä)
        function showRoadview(lat, lng, name) {
            const roadviewContainer = document.getElementById('roadview');

            // Ï†ÑÏó≠ Î≥ÄÏàò Ï¥àÍ∏∞Ìôî (ÏóÜÏúºÎ©¥ ÏÉùÏÑ±)
            if (!roadview) {
                roadview = new kakao.maps.Roadview(roadviewContainer);
                roadviewClient = new kakao.maps.RoadviewClient();
            }

            const position = new kakao.maps.LatLng(lat, lng);

            roadviewClient.getNearestPanoId(position, 50, function (panoId) {
                if (panoId) {
                    roadviewContainer.style.display = 'block';

                    roadview.setPanoId(panoId);

                    kakao.maps.event.addListener(roadview, 'init', function () {
                        // ÎßàÏª§ Ï∂îÍ∞Ä
                        const rMarker = new kakao.maps.Marker({
                            position: position,
                            map: roadview
                        });

                        // Ïª§Ïä§ÌÖÄ Ïò§Î≤ÑÎ†àÏù¥ Ï∂îÍ∞Ä (Ïù¥Î¶ÑÏù¥ ÏûàÏùÑ Í≤ΩÏö∞)
                        if (name) {
                            const content = `
            <div class="custom-overlay" style="min-width:auto; padding:10px 15px; box-shadow:0 4px 12px rgba(0,0,0,0.3); border:1px solid #ddd;">
                <div class="overlay-title" style="margin:0; font-size:1rem; color:#1E3A8A;">${name}</div>
            </div>
            `;

                            const rvCustomOverlay = new kakao.maps.CustomOverlay({
                                position: position,
                                content: content,
                                yAnchor: 1.5
                            });
                            rvCustomOverlay.setMap(roadview);
                        }

                        // Î∑∞Ìè¨Ïù∏Ìä∏ Ï°∞Ï†ï
                        const projection = roadview.getProjection();
                        const viewpoint = projection.viewpointFromCoords(rMarker.getPosition(), rMarker.getAltitude());
                        roadview.setViewpoint(viewpoint);

                        // Ï¥àÍ∏∞Ìôî Í∞í Ï†ÄÏû• (Reset Í∏∞Îä•Ïö©)
                        rvResetValue = {
                            panoId: panoId,
                            pan: viewpoint.pan,
                            tilt: viewpoint.tilt,
                            zoom: viewpoint.zoom
                        };

                        // Ïô∏Î∂Ä ÎßÅÌÅ¨ ÏóÖÎç∞Ïù¥Ìä∏
                        const rvLink = document.getElementById('rvLink');
                        if (rvLink) {
                            rvLink.href = 'https://map.kakao.com/?panoid=' + panoId + '&pan=' + viewpoint.pan + '&tilt=' + viewpoint.tilt + '&zoom=' + viewpoint.zoom;
                        }
                    });
                } else {
                    alert('Ìï¥Îãπ ÏúÑÏπòÏùò Î°úÎìúÎ∑∞Í∞Ä ÏóÜÏäµÎãàÎã§.');
                }
            });
        }

        // Î°úÎìúÎ∑∞ Î¶¨ÏÖã Ìï®Ïàò
        function resetRoadview() {
            if (roadview && rvResetValue.panoId) {
                roadview.setViewpoint({
                    pan: rvResetValue.pan,
                    tilt: rvResetValue.tilt,
                    zoom: rvResetValue.zoom
                });
                roadview.setPanoId(rvResetValue.panoId);
            }
        }

        // Î°úÎìúÎ∑∞ Îã´Í∏∞ Ìï®Ïàò
        function closeRoadview() {
            document.getElementById('roadview').style.display = 'none';
            document.getElementById('roadview-close').style.display = 'none';
        }

        // Toggle Roadview Mode
        function toggleRoadviewMode() {
            const btn = document.getElementById('roadviewBtn');
            isRoadviewMode = !isRoadviewMode;

            if (isRoadviewMode) {
                btn.classList.add('active');

                // Switch to Roadview overlay
                map.addOverlayMapTypeId(kakao.maps.MapTypeId.ROADVIEW);

                // Create Roadview Walker Marker (Dongdong-i)
                const markImage = new kakao.maps.MarkerImage(
                    'https://t1.daumcdn.net/localimg/localimages/07/2018/pc/roadview_minimap_wk_2018.png',
                    new kakao.maps.Size(26, 46),
                    {
                        spriteSize: new kakao.maps.Size(1666, 168),
                        spriteOrigin: new kakao.maps.Point(705, 114),
                        offset: new kakao.maps.Point(13, 46)
                    }
                );

                if (!roadviewMarker) {
                    roadviewMarker = new kakao.maps.Marker({
                        image: markImage,
                        position: map.getCenter(),
                        draggable: true,
                        map: map
                    });

                    // Event: When drag ends, show roadview
                    kakao.maps.event.addListener(roadviewMarker, 'dragend', function () {
                        const position = roadviewMarker.getPosition();
                        showRoadview(position.getLat(), position.getLng());
                    });
                } else {
                    roadviewMarker.setPosition(map.getCenter());
                    roadviewMarker.setMap(map);
                }

                alert('ÏßÄÎèÑ ÏúÑÏùò ÌååÎûÄ ÏÑ†(ÎèÑÎ°ú)Î•º ÌÅ¥Î¶≠ÌïòÎ©¥ Î°úÎìúÎ∑∞Í∞Ä Ïó¥Î¶ΩÎãàÎã§.');

            } else {
                btn.classList.remove('active');

                // Remove Roadview overlay
                map.removeOverlayMapTypeId(kakao.maps.MapTypeId.ROADVIEW);

                // Remove Marker
                if (roadviewMarker) {
                    roadviewMarker.setMap(null);
                }

                // Hide Roadview container if open
                closeRoadview();
            }
        }

        // Î°úÎìúÎ∑∞ Î™®Îìú ÌÜ†Í∏Ä Ìï®Ïàò
        function toggleRoadviewMode() {
            // ... (Í∏∞Ï°¥ ÏΩîÎìú ÏÉùÎûµ - Î≥ÄÍ≤Ω ÏóÜÏùå, MarkerTracker ÏïÑÎûòÏóê Ï∂îÍ∞ÄÌïòÍ∏∞ ÏúÑÌï¥ ÏúÑÏπòÎßå Ïû°Ïùå) ...
            // ÌïòÏßÄÎßå multi_replaceÏùò ÌäπÏÑ±ÏÉÅ ÎßàÏßÄÎßâ chunkÎäî ÌååÏùº ÎÅùÎ∂ÄÎ∂ÑÏóê Ï∂îÍ∞ÄÌïòÎäî Í≤ÉÏù¥ ÏïàÏ†ÑÌï®.
            // Ïó¨Í∏∞ÏÑúÎäî MarkerTracker ÌÅ¥ÎûòÏä§ Ï†ïÏùòÎ•º ÌååÏùº Îß® ÎÅù(</body> ÏßÅÏ†Ñ)Ïóê Ï∂îÍ∞ÄÌïòÎäî Ï†ÑÎûµ ÏÇ¨Ïö©.
        }

        /**
         * ÏßÄÎèÑ ÏòÅÏó≠ Ïô∏Î∂ÄÏóê Ï°¥Ïû¨ÌïòÎäî ÎßàÏª§Î•º Ï∂îÏ†ÅÌïòÎäî Í∏∞Îä•ÏùÑ Í∞ÄÏßÑ Í∞ùÏ≤¥ÏûÖÎãàÎã§.
         * ÌÅ¥Î¶¨Ìïë ÏïåÍ≥†Î¶¨Ï¶òÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ trackerÏùò Ï¢åÌëúÎ•º Íµ¨ÌïòÍ≥† ÏûàÏäµÎãàÎã§.
         */
        function MarkerTracker(map, target) {
            // ÌÅ¥Î¶¨ÌïëÏùÑ ÏúÑÌïú outcode
            var OUTCODE = {
                INSIDE: 0, // 0b0000
                TOP: 8, //0b1000
                RIGHT: 2, // 0b0010
                BOTTOM: 4, // 0b0100
                LEFT: 1 // 0b0001
            };

            // viewport ÏòÅÏó≠ÏùÑ Íµ¨ÌïòÍ∏∞ ÏúÑÌïú bufferÍ∞í
            var BOUNDS_BUFFER = 30;

            // ÌÅ¥Î¶¨Ìïë ÏïåÍ≥†Î¶¨Ï¶òÏúºÎ°ú trackerÏùò Ï¢åÌëúÎ•º Íµ¨ÌïòÍ∏∞ ÏúÑÌïú bufferÍ∞í
            var CLIP_BUFFER = 40;

            // trakcer ÏóòÎ¶¨Î®ºÌä∏
            var tracker = document.createElement('div');
            tracker.className = 'tracker';

            // ÎÇ¥Î∂Ä ÏïÑÏù¥ÏΩò
            var icon = document.createElement('div');
            icon.className = 'icon';

            // Ïô∏Î∂ÄÏóê ÏûàÎäî targetÏùò ÏúÑÏπòÏóê Îî∞Îùº ÌöåÏ†ÑÌïòÎäî ÎßêÌíçÏÑ† Î™®ÏñëÏùò ÏóòÎ¶¨Î®ºÌä∏
            var balloon = document.createElement('div');
            balloon.className = 'balloon';

            tracker.appendChild(balloon);
            tracker.appendChild(icon);

            map.getNode().appendChild(tracker);

            // trakerÎ•º ÌÅ¥Î¶≠ÌïòÎ©¥ targetÏùò ÏúÑÏπòÎ•º ÏßÄÎèÑ Ï§ëÏã¨ÏúºÎ°ú ÏßÄÏ†ïÌïòÍ≥† Ïò§Î≤ÑÎ†àÏù¥ ÌëúÏãú
            tracker.onclick = function () {
                map.setCenter(target.getPosition());
                setVisible(false);
                // Ìï¥Îãπ ÎßàÏª§Ïùò Ïò§Î≤ÑÎ†àÏù¥ Ïó¥Í∏∞
                if (target.storeInfo) {
                    showStoreInfoOnMap(target.storeInfo);
                }
            };

            // targetÏùò ÏúÑÏπòÎ•º Ï∂îÏ†ÅÌïòÎäî Ìï®Ïàò
            function tracking() {
                var proj = map.getProjection();

                // ÏßÄÎèÑÏùò ÏòÅÏó≠ÏùÑ Íµ¨Ìï©ÎãàÎã§.
                var bounds = map.getBounds();

                // ÏßÄÎèÑÏùò ÏòÅÏó≠ÏùÑ Í∏∞Ï§ÄÏúºÎ°ú ÌôïÏû•Îêú ÏòÅÏó≠ÏùÑ Íµ¨Ìï©ÎãàÎã§.
                var extBounds = extendBounds(bounds, proj);

                // targetÏù¥ ÌôïÏû•Îêú ÏòÅÏó≠Ïóê ÏÜçÌïòÎäîÏßÄ ÌåêÎã®ÌïòÍ≥†
                if (extBounds.contain(target.getPosition())) {
                    // ÏÜçÌïòÎ©¥ trackerÎ•º Ïà®ÍπÅÎãàÎã§.
                    setVisible(false);
                } else {
                    // targetÏù¥ ÏòÅÏó≠ Î∞ñÏóê ÏûàÏúºÎ©¥ Í≥ÑÏÇ∞ÏùÑ ÏãúÏûëÌï©ÎãàÎã§.

                    // TooltipMarkerÏùò ÏúÑÏπò
                    var pos = proj.containerPointFromCoords(target.getPosition());

                    // ÏßÄÎèÑ Ï§ëÏã¨Ïùò ÏúÑÏπò
                    var center = proj.containerPointFromCoords(map.getCenter());

                    // ÌòÑÏû¨ Î≥¥Ïù¥Îäî ÏßÄÎèÑÏùò ÏòÅÏó≠Ïùò ÎÇ®ÏÑúÏ™Ω ÌôîÎ©¥ Ï¢åÌëú
                    var sw = proj.containerPointFromCoords(bounds.getSouthWest());

                    // ÌòÑÏû¨ Î≥¥Ïù¥Îäî ÏßÄÎèÑÏùò ÏòÅÏó≠Ïùò Î∂ÅÎèôÏ™Ω ÌôîÎ©¥ Ï¢åÌëú
                    var ne = proj.containerPointFromCoords(bounds.getNorthEast());

                    // ÌÅ¥Î¶¨ÌïëÌï† Í∞ÄÏÉÅÏùò ÎÇ¥Î∂Ä ÏòÅÏó≠ÏùÑ ÎßåÎì≠ÎãàÎã§.
                    var top = ne.y + CLIP_BUFFER;
                    var right = ne.x - CLIP_BUFFER;
                    var bottom = sw.y - CLIP_BUFFER;
                    var left = sw.x + CLIP_BUFFER;

                    // Í≥ÑÏÇ∞Îêú Î™®Îì† Ï¢åÌëúÎ•º ÌÅ¥Î¶¨Ìïë Î°úÏßÅÏóê ÎÑ£Ïñ¥ Ï¢åÌëúÎ•º ÏñªÏäµÎãàÎã§.
                    var clipPosition = getClipPosition(top, right, bottom, left, center, pos);

                    // ÌÅ¥Î¶¨ÌïëÎêú Ï¢åÌëúÎ•º trackerÏùò ÏúÑÏπòÎ°ú ÏÇ¨Ïö©Ìï©ÎãàÎã§.
                    tracker.style.top = clipPosition.y + 'px';
                    tracker.style.left = clipPosition.x + 'px';

                    // ÎßêÌíçÏÑ†Ïùò ÌöåÏ†ÑÍ∞ÅÏùÑ ÏñªÏäµÎãàÎã§.
                    var angle = getAngle(center, pos);

                    // ÌöåÏ†ÑÍ∞ÅÏùÑ CSS transformÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ ÏßÄÏ†ïÌï©ÎãàÎã§.
                    balloon.style.cssText +=
                        '-ms-transform: rotate(' + angle + 'deg);' +
                        '-webkit-transform: rotate(' + angle + 'deg);' +
                        'transform: rotate(' + angle + 'deg);';

                    // targetÏù¥ ÏòÅÏó≠ Î∞ñÏóê ÏûàÏùÑ Í≤ΩÏö∞ trackerÎ•º ÎÖ∏Ï∂úÌï©ÎãàÎã§.
                    setVisible(true);
                }
            }

            // ÏÉÅÌïòÏ¢åÏö∞Î°ú BOUNDS_BUFFER(30px)ÎßåÌÅº boundsÎ•º ÌôïÏû• ÌïòÎäî Ìï®Ïàò
            function extendBounds(bounds, proj) {
                var sw = proj.pointFromCoords(bounds.getSouthWest());
                var ne = proj.pointFromCoords(bounds.getNorthEast());

                sw.x -= BOUNDS_BUFFER;
                sw.y += BOUNDS_BUFFER;

                ne.x += BOUNDS_BUFFER;
                ne.y -= BOUNDS_BUFFER;

                return new kakao.maps.LatLngBounds(
                    proj.coordsFromPoint(sw), proj.coordsFromPoint(ne));
            }

            // Cohen‚ÄìSutherland clipping algorithm
            function getClipPosition(top, right, bottom, left, inner, outer) {
                function calcOutcode(x, y) {
                    var outcode = OUTCODE.INSIDE;

                    if (x < left) {
                        outcode |= OUTCODE.LEFT;
                    } else if (x > right) {
                        outcode |= OUTCODE.RIGHT;
                    }

                    if (y < top) {
                        outcode |= OUTCODE.TOP;
                    } else if (y > bottom) {
                        outcode |= OUTCODE.BOTTOM;
                    }

                    return outcode;
                }

                var ix = inner.x;
                var iy = inner.y;
                var ox = outer.x;
                var oy = outer.y;

                var code = calcOutcode(ox, oy);

                while (true) {
                    if (!code) {
                        break;
                    }

                    if (code & OUTCODE.TOP) {
                        ox = ox + (ix - ox) / (iy - oy) * (top - oy);
                        oy = top;
                    } else if (code & OUTCODE.RIGHT) {
                        oy = oy + (iy - oy) / (ix - ox) * (right - ox);
                        ox = right;
                    } else if (code & OUTCODE.BOTTOM) {
                        ox = ox + (ix - ox) / (iy - oy) * (bottom - oy);
                        oy = bottom;
                    } else if (code & OUTCODE.LEFT) {
                        oy = oy + (iy - oy) / (ix - ox) * (left - ox);
                        ox = left;
                    }

                    code = calcOutcode(ox, oy);
                }

                return { x: ox, y: oy };
            }

            // ÎßêÌíçÏÑ†Ïùò ÌöåÏ†ÑÍ∞ÅÏùÑ Íµ¨ÌïòÍ∏∞ ÏúÑÌïú Ìï®Ïàò
            function getAngle(center, target) {
                var dx = target.x - center.x;
                var dy = center.y - target.y;
                var deg = Math.atan2(dy, dx) * 180 / Math.PI;

                return ((-deg + 360) % 360 | 0) + 90;
            }

            // trackerÏùò Î≥¥ÏûÑ/Ïà®ÍπÄÏùÑ ÏßÄÏ†ïÌïòÎäî Ìï®Ïàò
            function setVisible(visible) {
                tracker.style.display = visible ? 'block' : 'none';
            }

            // Map Í∞ùÏ≤¥Ïùò 'zoom_start' Ïù¥Î≤§Ìä∏ Ìï∏Îì§Îü¨
            function hideTracker() {
                setVisible(false);
            }

            // targetÏùò Ï∂îÏ†ÅÏùÑ Ïã§ÌñâÌï©ÎãàÎã§.
            this.run = function () {
                kakao.maps.event.addListener(map, 'zoom_start', hideTracker);
                kakao.maps.event.addListener(map, 'zoom_changed', tracking);
                kakao.maps.event.addListener(map, 'center_changed', tracking);
                tracking();
            };

            // targetÏùò Ï∂îÏ†ÅÏùÑ Ï§ëÏßÄÌï©ÎãàÎã§.
            this.stop = function () {
                kakao.maps.event.removeListener(map, 'zoom_start', hideTracker);
                kakao.maps.event.removeListener(map, 'zoom_changed', tracking);
                kakao.maps.event.removeListener(map, 'center_changed', tracking);
                setVisible(false);
            };
        }

        // --- Marker Filtering Logic ---
        function filterMarkers(type) {
            if (!clusterer || !markers.length) return;

            // Highlight selected legend item
            ['gold', 'silver', 'normal'].forEach(t => {
                const el = document.getElementById('legend-' + t);
                if (el) el.style.opacity = (type === 'all' || type === t) ? '1' : '0.4';
            });
            const titleEl = document.querySelector('.legend-title');
            if (titleEl) titleEl.style.fontWeight = type === 'all' ? 'bold' : 'normal';

            // Filter markers
            const filteredMarkers = markers.filter(marker => {
                const count = marker.storeInfo.first;
                if (type === 'all') return true;
                if (type === 'gold') return count >= 3;
                if (type === 'silver') return count >= 1 && count < 3;
                if (type === 'normal') return count === 0;
                return true;
            });

            // Update Clusterer
            clusterer.clear();
            clusterer.addMarkers(filteredMarkers);
        }

        // --- Map Utilities (Resize & Bounds) ---

        // 1. Window Resize Handler
        window.addEventListener('resize', function () {
            if (map) {
                map.relayout();
            }
        });

        // 2. Bounds Changed Handler
        function initBoundsListener() {
            const resultDiv = document.getElementById('clickResult');
            if (map && resultDiv) {
                kakao.maps.event.addListener(map, 'bounds_changed', function () {
                    const center = map.getCenter();
                    const bounds = map.getBounds();
                    const sw = bounds.getSouthWest();
                    const ne = bounds.getNorthEast();

                    const message = `
            < div style = "font-size:0.8rem; line-height:1.4;" >
                <span style="color:#2563EB;">Ï§ëÏã¨:</span> ${center.getLat().toFixed(4)}, ${center.getLng().toFixed(4)} <br>
                    <span style="color:#666; font-size:0.75rem;">
                        ÏòÅÏó≠: (${sw.getLat().toFixed(3)}, ${sw.getLng().toFixed(3)}) ~ <br>
                            (${ne.getLat().toFixed(3)}, ${ne.getLng().toFixed(3)})
                    </span>
                </div>
                    `;
                    resultDiv.innerHTML = message;
                });
            }
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÏßÄÎèÑ Ï¥àÍ∏∞Ìôî
        window.onload = function () {
            initMap();
        };
    </script>

    <!-- Guide Section -->
    <div style="background: white; padding: 60px 20px; margin-top: 20px;">
        <div style="max-width: 1000px; margin: 0 auto;">
            <h2
                style="text-align: center; font-size: 2.2rem; font-weight: 700; color: var(--primary-blue); margin-bottom: 40px;">
                üó∫Ô∏è Î™ÖÎãπ ÌåêÎß§Ï†ê ÏßÄÎèÑ ÏÇ¨Ïö© Í∞ÄÏù¥Îìú
            </h2>

            <div
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; margin-bottom: 50px;">
                <div style="padding: 30px; background: #f8f9fa; border-radius: 16px; border-left: 4px solid  #FFD700;">
                    <h3 style="color: var(--primary-blue); font-size: 1.4rem; margin-bottom: 15px; font-weight: 700;">üìç
                        ÎßàÏª§ ÌôïÏù∏ÌïòÍ∏∞</h3>
                    <p style="font-size: 1.05rem; line-height: 1.8; color: var(--text-secondary); margin-bottom: 10px;">
                        ÏßÄÎèÑÏóê ÌëúÏãúÎêú ÌíçÏÑ† ÎßàÏª§Î•º ÌÅ¥Î¶≠ÌïòÎ©¥ ÌåêÎß§Ï†ê Ï†ïÎ≥¥Î•º ÌôïÏù∏Ìï† Ïàò ÏûàÏäµÎãàÎã§.
                    </p>
                    <ul style="font-size: 1rem; line-height: 1.8; color: var(--text-secondary); padding-left: 20px;">
                        <li><strong>Í∏àÏÉâ ÎßàÏª§(3+)</strong>: 1Îì± 3Ìöå Ïù¥ÏÉÅ ÎãπÏ≤® ÌåêÎß§Ï†ê</li>
                        <li><strong>ÏùÄÏÉâ ÎßàÏª§(1-2)</strong>: 1Îì± 1-2Ìöå ÎãπÏ≤® ÌåêÎß§Ï†ê</li>
                        <li><strong>ÌöåÏÉâ ÎßàÏª§</strong>: ÏùºÎ∞ò ÌåêÎß§Ï†ê</li>
                    </ul>
                </div>

                <div style="padding: 30px; background: #f8f9fa; border-radius: 16px; border-left: 4px solid #FEE500;">
                    <h3 style="color: var(--primary-orange); font-size: 1.4rem; margin-bottom: 15px; font-weight: 700;">
                        üì∑ Î°úÎìúÎ∑∞ Í∏∞Îä•</h3>
                    <p style="font-size: 1.05rem; line-height: 1.8; color: var(--text-secondary); margin-bottom: 10px;">
                        ÎßàÏª§Î•º ÌÅ¥Î¶≠ÌïòÎ©¥ ÎÇòÌÉÄÎÇòÎäî Ïù∏Ìè¨ÏúàÎèÑÏö∞ÏóêÏÑú "Î°úÎìúÎ∑∞ Î≥¥Í∏∞" Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÎ©¥
                        Ìï¥Îãπ ÌåêÎß§Ï†êÏùò Í±∞Î¶¨Î∑∞Î•º ÌéòÏù¥ÏßÄ ÎÇ¥ÏóêÏÑú Î∞îÎ°ú ÌôïÏù∏Ìï† Ïàò ÏûàÏäµÎãàÎã§.
                    </p>
                    <p style="font-size: 1rem; line-height: 1.8; color: var(--text-secondary);">
                        Ïã§Ï†úÎ°ú ÌåêÎß§Ï†êÏùÑ Î∞©Î¨∏ÌïòÍ∏∞ Ï†ÑÏóê Ï£ºÎ≥Ä ÌôòÍ≤ΩÍ≥º ÏúÑÏπòÎ•º ÎØ∏Î¶¨ ÌååÏïÖÌï† Ïàò ÏûàÏñ¥ Ïú†Ïö©Ìï©ÎãàÎã§.
                    </p>
                </div>

                <div style="padding: 30px; background: #f8f9fa; border-radius: 16px; border-left: 4px solid #3B82F6;">
                    <h3 style="color: #667eea; font-size: 1.4rem; margin-bottom: 15px; font-weight: 700;">üîç Í≤ÄÏÉâ Í∏∞Îä•</h3>
                    <p style="font-size: 1.05rem; line-height: 1.8; color: var(--text-secondary); margin-bottom: 10px;">
                        ÏôºÏ™Ω ÏÉÅÎã®Ïùò Í≤ÄÏÉâÏ∞ΩÏóê ÏßÄÏó≠Î™ÖÏù¥ÎÇò Ïû•ÏÜåÎ™ÖÏùÑ ÏûÖÎ†•ÌïòÍ≥† Í≤ÄÏÉâÌïòÎ©¥ Ìï¥Îãπ ÏúÑÏπòÎ°ú ÏßÄÎèÑÍ∞Ä Ïù¥ÎèôÌï©ÎãàÎã§.
                    </p>
                    <ul style="font-size: 1rem; line-height: 1.8; color: var(--text-secondary); padding-left: 20px;">
                        <li>Í≤ÄÏÉâ ÌõÑ Ï£ºÎ≥Ä 1km Ïù¥ÎÇ¥Ïùò Î™ÖÎãπ ÎßàÏª§Í∞Ä ÏûêÎèôÏúºÎ°ú Í∞ïÏ°∞Îê©ÎãàÎã§</li>
                        <li>Enter ÌÇ§Î°úÎèÑ Í≤ÄÏÉâÏù¥ Í∞ÄÎä•Ìï©ÎãàÎã§</li>
                        <li>ÏòàÏãú: "Í∞ïÎÇ®Ïó≠", "ÏÇºÏÑ±Îèô", "Ïó¨ÏùòÎèÑ" Îì±</li>
                    </ul>
                </div>
            </div>

            <div
                style="background: linear-gradient(135deg, #e0f2f1 0%, #b2dfdb 100%); padding: 30px; border-radius: 12px; border-left: 5px solid #00897b; margin-bottom: 40px;">
                <h3 style="color: #00695c; font-size: 1.3rem; margin-bottom: 15px; font-weight: 700;">üí° ÎòëÎòëÌïú ÌôúÏö© ÌåÅ</h3>
                <ul
                    style="font-size: 1.05rem; line-height: 2; color: var(--text-secondary); padding-left: 20px; margin: 0;">
                    <li><strong>ÎÇ¥ ÏúÑÏπò Î≤ÑÌäº</strong>ÏùÑ ÌÅ¥Î¶≠ÌïòÎ©¥ ÌòÑÏû¨ ÏúÑÏπò Ï£ºÎ≥ÄÏùò Î™ÖÎãπÏùÑ Îπ†Î•¥Í≤å Ï∞æÏùÑ Ïàò ÏûàÏäµÎãàÎã§</li>
                    <li><strong>Ï§å Ïù∏/ÏïÑÏõÉ</strong>ÏùÑ ÌÜµÌï¥ Îçî ÎÑìÏùÄ ÏßÄÏó≠Ïùò Î™ÖÎãπÏùÑ ÎπÑÍµêÌï¥Î≥¥ÏÑ∏Ïöî</li>
                    <li><strong>ÌÅ¥Îü¨Ïä§ÌÑ∞ÎßÅ Í∏∞Îä•</strong>ÏúºÎ°ú Ï§å ÏïÑÏõÉ Ïãú Ïó¨Îü¨ ÎßàÏª§Í∞Ä ÌïòÎÇòÎ°ú Í∑∏Î£πÌôîÎêòÏñ¥ Î≥¥Í∏∞ Ìé∏Î¶¨Ìï©ÎãàÎã§</li>
                    <li><strong>Í∏∏Ï∞æÍ∏∞ Î≤ÑÌäº</strong>ÏùÑ ÌÅ¥Î¶≠ÌïòÎ©¥ Ïπ¥Ïπ¥Ïò§Îßµ Ïï±ÏúºÎ°ú Í≤ΩÎ°ú ÏïàÎÇ¥Î•º Î∞õÏùÑ Ïàò ÏûàÏäµÎãàÎã§</li>
                </ul>
            </div>

            <div
                style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); padding: 30px; border-radius: 12px; border-left: 5px solid #f57c00;">
                <h3 style="color: #e65100; font-size: 1.3rem; margin-bottom: 15px; font-weight: 700;">‚ö†Ô∏è Ïú†ÏùòÏÇ¨Ìï≠</h3>
                <ul
                    style="font-size: 1.05rem; line-height: 2; color: var(--text-secondary); padding-left: 20px; margin: 0;">
                    <li>ÌåêÎß§Ï†êÏùò Í≥ºÍ±∞ ÎãπÏ≤® Ïù¥Î†•ÏùÄ <strong>Ï∞∏Í≥†Ïö©</strong>Ïù¥Î©∞, ÎØ∏Îûò ÎãπÏ≤®ÏùÑ Î≥¥Ïû•ÌïòÏßÄ ÏïäÏäµÎãàÎã§</li>
                    <li>Î™®Îì† Î≥µÍ∂å ÌåêÎß§Ï†êÏùò ÎãπÏ≤® ÌôïÎ•†ÏùÄ <strong>ÎèôÏùº</strong>Ìï©ÎãàÎã§</li>
                    <li>Î™ÖÎãπ Î∞©Î¨∏ÏùÄ Ïû¨ÎØ∏ÏôÄ Ìù•ÎØ∏Î•º ÏúÑÌïú Í≤ÉÏù¥Î©∞, Í≥ºÎèÑÌïú Í∏∞ÎåÄÎäî Í∏àÎ¨ºÏûÖÎãàÎã§</li>
                    <li>Ï±ÖÏûÑ ÏûàÎäî Î≥µÍ∂å Íµ¨Îß§Î•º ÏúÑÌï¥ Ï†ÅÏ†àÌïú ÏòàÏÇ∞ Í¥ÄÎ¶¨Î•º Í∂åÏû•Ìï©ÎãàÎã§</li>
                </ul>
            </div>

            <div style="text-align: center; margin-top: 50px;">
                <h3 style="font-size: 1.8rem; font-weight: 700; color: var(--text-primary); margin-bottom: 30px;">
                    üí¨ Îçî ÏïåÏïÑÎ≥¥Í∏∞
                </h3>
                <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">
                    <a href="about.html"
                        style="text-decoration: none; padding: 15px 30px; background: var(--primary-blue); color: white; border-radius: 10px; font-weight: 600; transition: all 0.3s ease;">
                        ÏÑúÎπÑÏä§ ÏÜåÍ∞ú
                    </a>
                    <a href="guide.html"
                        style="text-decoration: none; padding: 15px 30px; background: var(--primary-orange); color: white; border-radius: 10px; font-weight: 600; transition: all 0.3s ease;">
                        Î≥µÍ∂å Í∞ÄÏù¥Îìú
                    </a>
                    <a href="faq.html"
                        style="text-decoration: none; padding: 15px 30px; background: #667eea; color: white; border-radius: 10px; font-weight: 600; transition: all 0.3s ease;">
                        ÏûêÏ£º Î¨ªÎäî ÏßàÎ¨∏
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="footer" style="position: relative; margin-top: 0;">
        <p><strong>‚ö†Ô∏è Î©¥Ï±Ö Ï°∞Ìï≠:</strong> ÌåêÎß§Ï†ê ÎãπÏ≤® Ï†ïÎ≥¥Îäî Ï∞∏Í≥†Ïö©Ïù¥Î©∞, ÎãπÏ≤®ÏùÑ Î≥¥Ïû•ÌïòÏßÄ ÏïäÏäµÎãàÎã§.</p>
        <p>
            <a href="privacy.html" style="color: white; text-decoration: underline;">Í∞úÏù∏Ï†ïÎ≥¥Ï≤òÎ¶¨Î∞©Ïπ®</a> |
            <a href="about.html" style="color: white; text-decoration: underline;">ÏÑúÎπÑÏä§ ÏÜåÍ∞ú</a> |
            <a href="https://github.com/ocean-no1/jocoding/issues" target="_blank"
                style="color: white; text-decoration: underline;">Î¨∏ÏùòÌïòÍ∏∞</a>
        </p>
        <p>¬© 2026 AI ÌÜµÍ≥Ñ Î∂ÑÏÑù ÏÑúÎπÑÏä§</p>
    </div>
</body>

</html>